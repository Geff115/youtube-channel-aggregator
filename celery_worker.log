ðŸ”— Celery broker: UPSTASH Redis (secure)
âœ… Using SSL with CERT_REQUIRED for Redis
 
 -------------- celery@DESKTOP-UHLI6AM v5.3.1 (emerald-rush)
--- ***** ----- 
-- ******* ---- Linux-5.10.102.1-microsoft-standard-WSL2-x86_64-with-glibc2.35 2025-06-14 05:36:45
- *** --- * --- 
- ** ---------- [config]
- ** ---------- .> app:         youtube_processor:0x7fd01719c790
- ** ---------- .> transport:   rediss://:**@gusc1-moved-kangaroo-31889.upstash.io:31889/0
- ** ---------- .> results:     rediss://:**@gusc1-moved-kangaroo-31889.upstash.io:31889/0
- *** --- * --- .> concurrency: 4 (prefork)
-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)
--- ***** ----- 
 -------------- [queues]
                .> batch_processing exchange=batch_processing(direct) key=batch_processing
                .> discovery        exchange=discovery(direct) key=discovery
                .> migration        exchange=migration(direct) key=migration
                .> youtube_api      exchange=youtube_api(direct) key=youtube_api

[tasks]
  . tasks.batch_process_channels
  . tasks.cleanup_old_jobs
  . tasks.discover_related_channels
  . tasks.fetch_channel_metadata
  . tasks.fetch_channel_videos
  . tasks.migrate_channel_data
  . tasks.monitor_system_health
  . tasks.reset_api_quotas

[2025-06-14 05:36:48,319: INFO/MainProcess] Connected to rediss://:**@gusc1-moved-kangaroo-31889.upstash.io:31889/0
[2025-06-14 05:36:49,343: INFO/MainProcess] mingle: searching for neighbors
[2025-06-14 05:36:53,745: INFO/MainProcess] mingle: all alone
[2025-06-14 05:37:01,905: INFO/MainProcess] celery@DESKTOP-UHLI6AM ready.
[2025-06-14 05:37:34,991: INFO/MainProcess] Task tasks.batch_process_channels[d621b3ab-d5c8-46ce-a64c-35a6897c0c04] received
[2025-06-14 05:37:35,079: INFO/ForkPoolWorker-4] Starting batch processing: metadata with batch size 1000
[2025-06-14 05:37:35,092: INFO/ForkPoolWorker-4] Processing batch 1: 2 channels
[2025-06-14 05:37:35,095: INFO/ForkPoolWorker-4] Connecting to database: postgresql://youtube:youtube123@localhost:5432/youtube_channels
[2025-06-14 05:37:35,114: INFO/ForkPoolWorker-4] file_cache is only supported with oauth2client<4.0.0
[2025-06-14 05:37:35,118: INFO/ForkPoolWorker-4] Using YouTube API key: youtube_key_4
[2025-06-14 05:37:35,992: WARNING/ForkPoolWorker-4] No data found for channel ID: UCsgp0TTPJdAqkaGMqq-HJ9w
[2025-06-14 05:37:36,440: WARNING/ForkPoolWorker-4] No data found for channel ID: UCiS882YPwZt1NkyM93oy4yQ
[2025-06-14 05:37:36,603: INFO/ForkPoolWorker-4] Batch 1 completed. Progress: 2/2 (100.0%)
[2025-06-14 05:37:38,721: INFO/ForkPoolWorker-4] Batch processing completed: 2 channels processed
[2025-06-14 05:37:40,035: INFO/ForkPoolWorker-4] Task tasks.batch_process_channels[d621b3ab-d5c8-46ce-a64c-35a6897c0c04] succeeded in 5.039686999999503s: {'status': 'completed', 'total_processed': 2, 'batches_completed': 1}
[2025-06-14 05:41:24,796: INFO/MainProcess] Task tasks.batch_process_channels[21d84f1e-b03e-47a2-b0fd-bb61e0800aa6] received
[2025-06-14 05:41:24,810: INFO/ForkPoolWorker-4] Starting batch processing: videos with batch size 500
[2025-06-14 05:41:25,347: INFO/ForkPoolWorker-4] Task tasks.batch_process_channels[21d84f1e-b03e-47a2-b0fd-bb61e0800aa6] succeeded in 0.5469807999998011s: {'status': 'completed', 'message': 'No channels to process'}
[2025-06-14 05:41:54,548: INFO/MainProcess] Task tasks.batch_process_channels[26a067ad-b9c4-4223-b418-592aafe5dee3] received
[2025-06-14 05:41:54,613: INFO/ForkPoolWorker-4] Starting batch processing: discovery with batch size 100
[2025-06-14 05:41:54,623: INFO/ForkPoolWorker-4] Processing batch 1: 11 channels
[2025-06-14 05:41:54,626: INFO/ForkPoolWorker-4] Connecting to database: postgresql://youtube:youtube123@localhost:5432/youtube_channels
[2025-06-14 05:41:54,640: INFO/ForkPoolWorker-4] file_cache is only supported with oauth2client<4.0.0
[2025-06-14 05:41:54,644: INFO/ForkPoolWorker-4] Using YouTube API key: youtube_key_5
[2025-06-14 05:41:55,283: ERROR/ForkPoolWorker-4] YouTube API error 404: channelNotFound
[2025-06-14 05:41:55,284: ERROR/ForkPoolWorker-4] Failed to get related channels for UCsgp0TTPJdAqkaGMqq-HJ9w: <HttpError 404 when requesting https://youtube.googleapis.com/youtube/v3/channelSections?part=snippet%2CcontentDetails&channelId=UCsgp0TTPJdAqkaGMqq-HJ9w&key=AIzaSyDXZxY5z4TJpt_8z8nONgb9JvZ72I_FyHE&alt=json returned "The channel is not found.". Details: "[{'message': 'The channel is not found.', 'domain': 'youtube.channelSection', 'reason': 'channelNotFound'}]">
[2025-06-14 05:41:55,284: INFO/ForkPoolWorker-4] YouTube featured channels found 0 channels for UCsgp0TTPJdAqkaGMqq-HJ9w
[2025-06-14 05:41:58,974: INFO/ForkPoolWorker-4] Content similarity found 2 channels for UCsgp0TTPJdAqkaGMqq-HJ9w
[2025-06-14 05:42:02,891: ERROR/ForkPoolWorker-4] SocialBlade discovery failed for UCsgp0TTPJdAqkaGMqq-HJ9w: 403 Client Error: Forbidden for url: https://socialblade.com/youtube/channel/UCsgp0TTPJdAqkaGMqq-HJ9w
[2025-06-14 05:42:09,888: INFO/ForkPoolWorker-4] Connecting to database: postgresql://youtube:youtube123@localhost:5432/youtube_channels
[2025-06-14 05:42:09,905: INFO/ForkPoolWorker-4] file_cache is only supported with oauth2client<4.0.0
[2025-06-14 05:42:09,907: INFO/ForkPoolWorker-4] Using YouTube API key: youtube_key_5
[2025-06-14 05:42:10,478: INFO/ForkPoolWorker-4] YouTube featured channels found 6 channels for UCBJycsmduvYEL83R_U4JriQ
[2025-06-14 05:42:14,311: INFO/ForkPoolWorker-4] Content similarity found 8 channels for UCBJycsmduvYEL83R_U4JriQ
[2025-06-14 05:42:17,942: ERROR/ForkPoolWorker-4] SocialBlade discovery failed for UCBJycsmduvYEL83R_U4JriQ: 403 Client Error: Forbidden for url: https://socialblade.com/youtube/channel/UCBJycsmduvYEL83R_U4JriQ
[2025-06-14 05:42:26,621: INFO/ForkPoolWorker-4] Connecting to database: postgresql://youtube:youtube123@localhost:5432/youtube_channels
[2025-06-14 05:42:26,639: INFO/ForkPoolWorker-4] file_cache is only supported with oauth2client<4.0.0
[2025-06-14 05:42:26,642: INFO/ForkPoolWorker-4] Using YouTube API key: youtube_key_5
[2025-06-14 05:42:27,143: INFO/ForkPoolWorker-4] YouTube featured channels found 0 channels for UC6nSFpj9HTCZ5t-N3Rm3-HA
[2025-06-14 05:42:30,889: INFO/ForkPoolWorker-4] Content similarity found 8 channels for UC6nSFpj9HTCZ5t-N3Rm3-HA
[2025-06-14 05:42:34,430: ERROR/ForkPoolWorker-4] SocialBlade discovery failed for UC6nSFpj9HTCZ5t-N3Rm3-HA: 403 Client Error: Forbidden for url: https://socialblade.com/youtube/channel/UC6nSFpj9HTCZ5t-N3Rm3-HA
[2025-06-14 05:42:37,354: ERROR/ForkPoolWorker-4] Discovery batch processing failed: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"
DETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.

[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]
[parameters: {'updated_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), 'last_updated__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), 'description__0': None, 'published_at__0': None, 'channel_id__0': 'UCj8mmqZghf7Mhoy9qiaTSKe', 'metadata_fetched__0': False, 'id__0': UUID('6f45792b-e36f-42e9-ade7-79512e81a096'), 'title__0': '', 'keywords__0': None, 'banner_url__0': None, 'discovered_from__0': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__0': None, 'language__0': None, 'created_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), 'view_count__0': None, 'discovery_processed__0': False, 'custom_url__0': None, 'country__0': None, 'topic_categories__0': None, 'thumbnail_url__0': None, 'video_count__0': None, 'source__0': 'discovery', 'videos_fetched__0': False, 'updated_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), 'last_updated__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), 'description__1': None, 'published_at__1': None, 'channel_id__1': 'UCyFFhA64ebheYwUl2jl7fgw', 'metadata_fetched__1': False, 'id__1': UUID('c0ff4495-665b-451c-9c3c-ecaefc0d4174'), 'title__1': '', 'keywords__1': None, 'banner_url__1': None, 'discovered_from__1': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__1': None, 'language__1': None, 'created_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), 'view_count__1': None, 'discovery_processed__1': False, 'custom_url__1': None, 'country__1': None, 'topic_categories__1': None, 'thumbnail_url__1': None, 'video_count__1': None, 'source__1': 'discovery', 'videos_fetched__1': False, 'updated_at__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), 'last_updated__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), 'description__2': None, 'published_at__2': None ... 452 parameters truncated ... 'thumbnail_url__21': None, 'video_count__21': None, 'source__21': 'discovery', 'videos_fetched__21': False, 'updated_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), 'last_updated__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), 'description__22': None, 'published_at__22': None, 'channel_id__22': 'UC2Xjws1oO90IpDs4JBy3Pb3', 'metadata_fetched__22': False, 'id__22': UUID('ac35b703-2a16-4d66-8906-b22b8e4d19f3'), 'title__22': '', 'keywords__22': None, 'banner_url__22': None, 'discovered_from__22': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__22': None, 'language__22': None, 'created_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), 'view_count__22': None, 'discovery_processed__22': False, 'custom_url__22': None, 'country__22': None, 'topic_categories__22': None, 'thumbnail_url__22': None, 'video_count__22': None, 'source__22': 'discovery', 'videos_fetched__22': False, 'updated_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), 'last_updated__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), 'description__23': None, 'published_at__23': None, 'channel_id__23': 'UCEJQ1GAYiEwi1ka7TjPCNAx', 'metadata_fetched__23': False, 'id__23': UUID('b150d79b-a285-4925-9d39-d8df4651d230'), 'title__23': '', 'keywords__23': None, 'banner_url__23': None, 'discovered_from__23': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__23': None, 'language__23': None, 'created_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), 'view_count__23': None, 'discovery_processed__23': False, 'custom_url__23': None, 'country__23': None, 'topic_categories__23': None, 'thumbnail_url__23': None, 'video_count__23': None, 'source__23': 'discovery', 'videos_fetched__23': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
[2025-06-14 05:42:37,355: ERROR/ForkPoolWorker-4] Batch 1 failed: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"
DETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.

[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]
[parameters: {'updated_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), 'last_updated__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), 'description__0': None, 'published_at__0': None, 'channel_id__0': 'UCj8mmqZghf7Mhoy9qiaTSKe', 'metadata_fetched__0': False, 'id__0': UUID('6f45792b-e36f-42e9-ade7-79512e81a096'), 'title__0': '', 'keywords__0': None, 'banner_url__0': None, 'discovered_from__0': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__0': None, 'language__0': None, 'created_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), 'view_count__0': None, 'discovery_processed__0': False, 'custom_url__0': None, 'country__0': None, 'topic_categories__0': None, 'thumbnail_url__0': None, 'video_count__0': None, 'source__0': 'discovery', 'videos_fetched__0': False, 'updated_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), 'last_updated__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), 'description__1': None, 'published_at__1': None, 'channel_id__1': 'UCyFFhA64ebheYwUl2jl7fgw', 'metadata_fetched__1': False, 'id__1': UUID('c0ff4495-665b-451c-9c3c-ecaefc0d4174'), 'title__1': '', 'keywords__1': None, 'banner_url__1': None, 'discovered_from__1': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__1': None, 'language__1': None, 'created_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), 'view_count__1': None, 'discovery_processed__1': False, 'custom_url__1': None, 'country__1': None, 'topic_categories__1': None, 'thumbnail_url__1': None, 'video_count__1': None, 'source__1': 'discovery', 'videos_fetched__1': False, 'updated_at__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), 'last_updated__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), 'description__2': None, 'published_at__2': None ... 452 parameters truncated ... 'thumbnail_url__21': None, 'video_count__21': None, 'source__21': 'discovery', 'videos_fetched__21': False, 'updated_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), 'last_updated__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), 'description__22': None, 'published_at__22': None, 'channel_id__22': 'UC2Xjws1oO90IpDs4JBy3Pb3', 'metadata_fetched__22': False, 'id__22': UUID('ac35b703-2a16-4d66-8906-b22b8e4d19f3'), 'title__22': '', 'keywords__22': None, 'banner_url__22': None, 'discovered_from__22': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__22': None, 'language__22': None, 'created_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), 'view_count__22': None, 'discovery_processed__22': False, 'custom_url__22': None, 'country__22': None, 'topic_categories__22': None, 'thumbnail_url__22': None, 'video_count__22': None, 'source__22': 'discovery', 'videos_fetched__22': False, 'updated_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), 'last_updated__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), 'description__23': None, 'published_at__23': None, 'channel_id__23': 'UCEJQ1GAYiEwi1ka7TjPCNAx', 'metadata_fetched__23': False, 'id__23': UUID('b150d79b-a285-4925-9d39-d8df4651d230'), 'title__23': '', 'keywords__23': None, 'banner_url__23': None, 'discovered_from__23': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__23': None, 'language__23': None, 'created_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), 'view_count__23': None, 'discovery_processed__23': False, 'custom_url__23': None, 'country__23': None, 'topic_categories__23': None, 'thumbnail_url__23': None, 'video_count__23': None, 'source__23': 'discovery', 'videos_fetched__23': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
[2025-06-14 05:42:37,355: ERROR/ForkPoolWorker-4] Batch processing failed: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"
DETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.

[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]
[parameters: {'updated_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), 'last_updated__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), 'description__0': None, 'published_at__0': None, 'channel_id__0': 'UCj8mmqZghf7Mhoy9qiaTSKe', 'metadata_fetched__0': False, 'id__0': UUID('6f45792b-e36f-42e9-ade7-79512e81a096'), 'title__0': '', 'keywords__0': None, 'banner_url__0': None, 'discovered_from__0': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__0': None, 'language__0': None, 'created_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), 'view_count__0': None, 'discovery_processed__0': False, 'custom_url__0': None, 'country__0': None, 'topic_categories__0': None, 'thumbnail_url__0': None, 'video_count__0': None, 'source__0': 'discovery', 'videos_fetched__0': False, 'updated_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), 'last_updated__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), 'description__1': None, 'published_at__1': None, 'channel_id__1': 'UCyFFhA64ebheYwUl2jl7fgw', 'metadata_fetched__1': False, 'id__1': UUID('c0ff4495-665b-451c-9c3c-ecaefc0d4174'), 'title__1': '', 'keywords__1': None, 'banner_url__1': None, 'discovered_from__1': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__1': None, 'language__1': None, 'created_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), 'view_count__1': None, 'discovery_processed__1': False, 'custom_url__1': None, 'country__1': None, 'topic_categories__1': None, 'thumbnail_url__1': None, 'video_count__1': None, 'source__1': 'discovery', 'videos_fetched__1': False, 'updated_at__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), 'last_updated__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), 'description__2': None, 'published_at__2': None ... 452 parameters truncated ... 'thumbnail_url__21': None, 'video_count__21': None, 'source__21': 'discovery', 'videos_fetched__21': False, 'updated_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), 'last_updated__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), 'description__22': None, 'published_at__22': None, 'channel_id__22': 'UC2Xjws1oO90IpDs4JBy3Pb3', 'metadata_fetched__22': False, 'id__22': UUID('ac35b703-2a16-4d66-8906-b22b8e4d19f3'), 'title__22': '', 'keywords__22': None, 'banner_url__22': None, 'discovered_from__22': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__22': None, 'language__22': None, 'created_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), 'view_count__22': None, 'discovery_processed__22': False, 'custom_url__22': None, 'country__22': None, 'topic_categories__22': None, 'thumbnail_url__22': None, 'video_count__22': None, 'source__22': 'discovery', 'videos_fetched__22': False, 'updated_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), 'last_updated__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), 'description__23': None, 'published_at__23': None, 'channel_id__23': 'UCEJQ1GAYiEwi1ka7TjPCNAx', 'metadata_fetched__23': False, 'id__23': UUID('b150d79b-a285-4925-9d39-d8df4651d230'), 'title__23': '', 'keywords__23': None, 'banner_url__23': None, 'discovered_from__23': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__23': None, 'language__23': None, 'created_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), 'view_count__23': None, 'discovery_processed__23': False, 'custom_url__23': None, 'country__23': None, 'topic_categories__23': None, 'thumbnail_url__23': None, 'video_count__23': None, 'source__23': 'discovery', 'videos_fetched__23': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
[2025-06-14 05:42:38,060: ERROR/ForkPoolWorker-4] Task tasks.batch_process_channels[26a067ad-b9c4-4223-b418-592aafe5dee3] raised unexpected: PendingRollbackError('This Session\'s transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"\nDETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.\n\n[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]\n[parameters: {\'updated_at__0\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), \'last_updated__0\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), \'description__0\': None, \'published_at__0\': None, \'channel_id__0\': \'UCj8mmqZghf7Mhoy9qiaTSKe\', \'metadata_fetched__0\': False, \'id__0\': UUID(\'6f45792b-e36f-42e9-ade7-79512e81a096\'), \'title__0\': \'\', \'keywords__0\': None, \'banner_url__0\': None, \'discovered_from__0\': UUID(\'3a5b2038-2f17-402b-a256-b054afe78545\'), \'subscriber_count__0\': None, \'language__0\': None, \'created_at__0\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), \'view_count__0\': None, \'discovery_processed__0\': False, \'custom_url__0\': None, \'country__0\': None, \'topic_categories__0\': None, \'thumbnail_url__0\': None, \'video_count__0\': None, \'source__0\': \'discovery\', \'videos_fetched__0\': False, \'updated_at__1\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), \'last_updated__1\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), \'description__1\': None, \'published_at__1\': None, \'channel_id__1\': \'UCyFFhA64ebheYwUl2jl7fgw\', \'metadata_fetched__1\': False, \'id__1\': UUID(\'c0ff4495-665b-451c-9c3c-ecaefc0d4174\'), \'title__1\': \'\', \'keywords__1\': None, \'banner_url__1\': None, \'discovered_from__1\': UUID(\'3a5b2038-2f17-402b-a256-b054afe78545\'), \'subscriber_count__1\': None, \'language__1\': None, \'created_at__1\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), \'view_count__1\': None, \'discovery_processed__1\': False, \'custom_url__1\': None, \'country__1\': None, \'topic_categories__1\': None, \'thumbnail_url__1\': None, \'video_count__1\': None, \'source__1\': \'discovery\', \'videos_fetched__1\': False, \'updated_at__2\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), \'last_updated__2\': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), \'description__2\': None, \'published_at__2\': None ... 452 parameters truncated ... \'thumbnail_url__21\': None, \'video_count__21\': None, \'source__21\': \'discovery\', \'videos_fetched__21\': False, \'updated_at__22\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), \'last_updated__22\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), \'description__22\': None, \'published_at__22\': None, \'channel_id__22\': \'UC2Xjws1oO90IpDs4JBy3Pb3\', \'metadata_fetched__22\': False, \'id__22\': UUID(\'ac35b703-2a16-4d66-8906-b22b8e4d19f3\'), \'title__22\': \'\', \'keywords__22\': None, \'banner_url__22\': None, \'discovered_from__22\': UUID(\'86833836-3160-429f-aff7-096a14e00a16\'), \'subscriber_count__22\': None, \'language__22\': None, \'created_at__22\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), \'view_count__22\': None, \'discovery_processed__22\': False, \'custom_url__22\': None, \'country__22\': None, \'topic_categories__22\': None, \'thumbnail_url__22\': None, \'video_count__22\': None, \'source__22\': \'discovery\', \'videos_fetched__22\': False, \'updated_at__23\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), \'last_updated__23\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), \'description__23\': None, \'published_at__23\': None, \'channel_id__23\': \'UCEJQ1GAYiEwi1ka7TjPCNAx\', \'metadata_fetched__23\': False, \'id__23\': UUID(\'b150d79b-a285-4925-9d39-d8df4651d230\'), \'title__23\': \'\', \'keywords__23\': None, \'banner_url__23\': None, \'discovered_from__23\': UUID(\'86833836-3160-429f-aff7-096a14e00a16\'), \'subscriber_count__23\': None, \'language__23\': None, \'created_at__23\': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), \'view_count__23\': None, \'discovery_processed__23\': False, \'custom_url__23\': None, \'country__23\': None, \'topic_categories__23\': None, \'thumbnail_url__23\': None, \'video_count__23\': None, \'source__23\': \'discovery\', \'videos_fetched__23\': False}]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)')
Traceback (most recent call last):
  File "/home/gabriel/youtube-channel-aggregator/app/tasks.py", line 705, in batch_process_channels
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1920, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 909, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"
DETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.

[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]
[parameters: {'updated_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), 'last_updated__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), 'description__0': None, 'published_at__0': None, 'channel_id__0': 'UCj8mmqZghf7Mhoy9qiaTSKe', 'metadata_fetched__0': False, 'id__0': UUID('6f45792b-e36f-42e9-ade7-79512e81a096'), 'title__0': '', 'keywords__0': None, 'banner_url__0': None, 'discovered_from__0': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__0': None, 'language__0': None, 'created_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), 'view_count__0': None, 'discovery_processed__0': False, 'custom_url__0': None, 'country__0': None, 'topic_categories__0': None, 'thumbnail_url__0': None, 'video_count__0': None, 'source__0': 'discovery', 'videos_fetched__0': False, 'updated_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), 'last_updated__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), 'description__1': None, 'published_at__1': None, 'channel_id__1': 'UCyFFhA64ebheYwUl2jl7fgw', 'metadata_fetched__1': False, 'id__1': UUID('c0ff4495-665b-451c-9c3c-ecaefc0d4174'), 'title__1': '', 'keywords__1': None, 'banner_url__1': None, 'discovered_from__1': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__1': None, 'language__1': None, 'created_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), 'view_count__1': None, 'discovery_processed__1': False, 'custom_url__1': None, 'country__1': None, 'topic_categories__1': None, 'thumbnail_url__1': None, 'video_count__1': None, 'source__1': 'discovery', 'videos_fetched__1': False, 'updated_at__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), 'last_updated__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), 'description__2': None, 'published_at__2': None ... 452 parameters truncated ... 'thumbnail_url__21': None, 'video_count__21': None, 'source__21': 'discovery', 'videos_fetched__21': False, 'updated_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), 'last_updated__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), 'description__22': None, 'published_at__22': None, 'channel_id__22': 'UC2Xjws1oO90IpDs4JBy3Pb3', 'metadata_fetched__22': False, 'id__22': UUID('ac35b703-2a16-4d66-8906-b22b8e4d19f3'), 'title__22': '', 'keywords__22': None, 'banner_url__22': None, 'discovered_from__22': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__22': None, 'language__22': None, 'created_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), 'view_count__22': None, 'discovery_processed__22': False, 'custom_url__22': None, 'country__22': None, 'topic_categories__22': None, 'thumbnail_url__22': None, 'video_count__22': None, 'source__22': 'discovery', 'videos_fetched__22': False, 'updated_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), 'last_updated__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), 'description__23': None, 'published_at__23': None, 'channel_id__23': 'UCEJQ1GAYiEwi1ka7TjPCNAx', 'metadata_fetched__23': False, 'id__23': UUID('b150d79b-a285-4925-9d39-d8df4651d230'), 'title__23': '', 'keywords__23': None, 'banner_url__23': None, 'discovered_from__23': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__23': None, 'language__23': None, 'created_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), 'view_count__23': None, 'discovery_processed__23': False, 'custom_url__23': None, 'country__23': None, 'topic_categories__23': None, 'thumbnail_url__23': None, 'video_count__23': None, 'source__23': 'discovery', 'videos_fetched__23': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/app/trace.py", line 477, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/app/trace.py", line 760, in __protected_call__
    return self.run(*args, **kwargs)
  File "/home/gabriel/youtube-channel-aggregator/app/tasks.py", line 717, in batch_process_channels
    logger.error(f"Batch processing failed: {str(e)}")
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1920, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 909, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "channels_channel_id_key"
DETAIL:  Key (channel_id)=(UCc_ycus0q7DSd85ZkmEY5ig) already exists.

[SQL: INSERT INTO channels (id, channel_id, title, description, subscriber_count, video_count, view_count, country, language, custom_url, published_at, thumbnail_url, banner_url, keywords, topic_categories, last_updated, metadata_fetched, videos_fetched, d ... 12008 characters truncated ... cessed__23)s, %(source__23)s, %(discovered_from__23)s::UUID, %(created_at__23)s, %(updated_at__23)s)]
[parameters: {'updated_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313869), 'last_updated__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313861), 'description__0': None, 'published_at__0': None, 'channel_id__0': 'UCj8mmqZghf7Mhoy9qiaTSKe', 'metadata_fetched__0': False, 'id__0': UUID('6f45792b-e36f-42e9-ade7-79512e81a096'), 'title__0': '', 'keywords__0': None, 'banner_url__0': None, 'discovered_from__0': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__0': None, 'language__0': None, 'created_at__0': datetime.datetime(2025, 6, 14, 4, 42, 37, 313867), 'view_count__0': None, 'discovery_processed__0': False, 'custom_url__0': None, 'country__0': None, 'topic_categories__0': None, 'thumbnail_url__0': None, 'video_count__0': None, 'source__0': 'discovery', 'videos_fetched__0': False, 'updated_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313889), 'last_updated__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313886), 'description__1': None, 'published_at__1': None, 'channel_id__1': 'UCyFFhA64ebheYwUl2jl7fgw', 'metadata_fetched__1': False, 'id__1': UUID('c0ff4495-665b-451c-9c3c-ecaefc0d4174'), 'title__1': '', 'keywords__1': None, 'banner_url__1': None, 'discovered_from__1': UUID('3a5b2038-2f17-402b-a256-b054afe78545'), 'subscriber_count__1': None, 'language__1': None, 'created_at__1': datetime.datetime(2025, 6, 14, 4, 42, 37, 313888), 'view_count__1': None, 'discovery_processed__1': False, 'custom_url__1': None, 'country__1': None, 'topic_categories__1': None, 'thumbnail_url__1': None, 'video_count__1': None, 'source__1': 'discovery', 'videos_fetched__1': False, 'updated_at__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313905), 'last_updated__2': datetime.datetime(2025, 6, 14, 4, 42, 37, 313901), 'description__2': None, 'published_at__2': None ... 452 parameters truncated ... 'thumbnail_url__21': None, 'video_count__21': None, 'source__21': 'discovery', 'videos_fetched__21': False, 'updated_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314207), 'last_updated__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314203), 'description__22': None, 'published_at__22': None, 'channel_id__22': 'UC2Xjws1oO90IpDs4JBy3Pb3', 'metadata_fetched__22': False, 'id__22': UUID('ac35b703-2a16-4d66-8906-b22b8e4d19f3'), 'title__22': '', 'keywords__22': None, 'banner_url__22': None, 'discovered_from__22': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__22': None, 'language__22': None, 'created_at__22': datetime.datetime(2025, 6, 14, 4, 42, 37, 314206), 'view_count__22': None, 'discovery_processed__22': False, 'custom_url__22': None, 'country__22': None, 'topic_categories__22': None, 'thumbnail_url__22': None, 'video_count__22': None, 'source__22': 'discovery', 'videos_fetched__22': False, 'updated_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314222), 'last_updated__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314218), 'description__23': None, 'published_at__23': None, 'channel_id__23': 'UCEJQ1GAYiEwi1ka7TjPCNAx', 'metadata_fetched__23': False, 'id__23': UUID('b150d79b-a285-4925-9d39-d8df4651d230'), 'title__23': '', 'keywords__23': None, 'banner_url__23': None, 'discovered_from__23': UUID('86833836-3160-429f-aff7-096a14e00a16'), 'subscriber_count__23': None, 'language__23': None, 'created_at__23': datetime.datetime(2025, 6, 14, 4, 42, 37, 314221), 'view_count__23': None, 'discovery_processed__23': False, 'custom_url__23': None, 'country__23': None, 'topic_categories__23': None, 'thumbnail_url__23': None, 'video_count__23': None, 'source__23': 'discovery', 'videos_fetched__23': False}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
[2025-06-14 05:47:52,376: INFO/MainProcess] Task tasks.batch_process_channels[1565c751-f379-4f4c-8304-bc36cdb1b84c] received
[2025-06-14 05:47:52,433: INFO/ForkPoolWorker-4] Starting batch processing: metadata with batch size 5000
[2025-06-14 05:47:52,447: INFO/ForkPoolWorker-4] Processing batch 1: 2 channels
[2025-06-14 05:47:52,452: INFO/ForkPoolWorker-4] Connecting to database: postgresql://youtube:youtube123@localhost:5432/youtube_channels
[2025-06-14 05:47:52,480: INFO/ForkPoolWorker-4] file_cache is only supported with oauth2client<4.0.0
[2025-06-14 05:47:52,483: INFO/ForkPoolWorker-4] Using YouTube API key: youtube_key_5
[2025-06-14 05:47:53,061: WARNING/ForkPoolWorker-4] No data found for channel ID: UCsgp0TTPJdAqkaGMqq-HJ9w
[2025-06-14 05:47:53,385: WARNING/ForkPoolWorker-4] No data found for channel ID: UCiS882YPwZt1NkyM93oy4yQ
[2025-06-14 05:47:53,493: INFO/ForkPoolWorker-4] Batch 1 completed. Progress: 2/2 (100.0%)
[2025-06-14 05:47:55,259: INFO/ForkPoolWorker-4] Batch processing completed: 2 channels processed
[2025-06-14 05:47:55,690: INFO/ForkPoolWorker-4] Task tasks.batch_process_channels[1565c751-f379-4f4c-8304-bc36cdb1b84c] succeeded in 3.31217259999994s: {'status': 'completed', 'total_processed': 2, 'batches_completed': 1}
[2025-06-14 07:24:19,885: WARNING/MainProcess] consumer: Connection to broker lost. Trying to re-establish the connection...
Traceback (most recent call last):
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/worker/consumer/consumer.py", line 336, in start
    blueprint.start(self)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/bootsteps.py", line 116, in start
    step.start(parent)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/worker/consumer/consumer.py", line 726, in start
    c.loop(*c.loop_args())
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/worker/loops.py", line 97, in asynloop
    next(loop)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/kombu/asynchronous/hub.py", line 373, in create_loop
    cb(*cbargs)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/kombu/transport/redis.py", line 1359, in on_readable
    self.cycle.on_readable(fileno)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/kombu/transport/redis.py", line 576, in on_readable
    chan.handlers[type]()
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/kombu/transport/redis.py", line 974, in _brpop_read
    dest__item = self.client.parse_response(self.client.connection,
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/client.py", line 1286, in parse_response
    response = connection.read_response()
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/connection.py", line 882, in read_response
    response = self._parser.read_response(disable_decoding=disable_decoding)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/connection.py", line 349, in read_response
    result = self._read_response(disable_decoding=disable_decoding)
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/connection.py", line 359, in _read_response
    raw = self._buffer.readline()
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/connection.py", line 262, in readline
    self._read_from_socket()
  File "/home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/redis/connection.py", line 215, in _read_from_socket
    raise ConnectionError(SERVER_CLOSED_CONNECTION_ERROR)
redis.exceptions.ConnectionError: Connection closed by server.
[2025-06-14 07:24:22,130: WARNING/MainProcess] /home/gabriel/youtube-channel-aggregator/venv/lib/python3.10/site-packages/celery/worker/consumer/consumer.py:386: CPendingDeprecationWarning: 
In Celery 5.1 we introduced an optional breaking change which
on connection loss cancels all currently executed tasks with late acknowledgement enabled.
These tasks cannot be acknowledged as the connection is gone, and the tasks are automatically redelivered
back to the queue. You can enable this behavior using the worker_cancel_long_running_tasks_on_connection_loss
setting. In Celery 5.1 it is set to False by default. The setting will be set to True by default in Celery 6.0.

  warnings.warn(CANCEL_TASKS_BY_DEFAULT, CPendingDeprecationWarning)

[2025-06-14 07:24:24,588: INFO/MainProcess] Connected to rediss://:**@gusc1-moved-kangaroo-31889.upstash.io:31889/0
[2025-06-14 07:24:25,494: INFO/MainProcess] mingle: searching for neighbors

worker: Hitting Ctrl+C again will terminate all running tasks!

worker: Warm shutdown (MainProcess)

worker: Warm shutdown (MainProcess)

worker: Warm shutdown (MainProcess)
[2025-06-14 07:40:45,590: INFO/MainProcess] mingle: all alone
